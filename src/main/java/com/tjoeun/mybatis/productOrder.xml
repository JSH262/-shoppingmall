<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductOrder">

	<!-- <typeAlias type="com.tjoeun.vo.MvcBoardVO" alias="MvcBoardVO" /> -->
	<insert id="insert" parameterType="ProductOrderVO">
		insert into product_order(user_id, id, product_id, product_amount, product_price, product_delivery_price, product_name, status, product_thumbnail)
		values(#{userId},
			<choose>
			    <when test="id != null">
					#{id}, 
			    </when>
			    <otherwise>
				    (select nvl(max(id) + 1, 0)
					from product_order
					where user_id = #{user_id}),
			    </otherwise>
			</choose>
			#{productId}, #{productAmount}, #{productPrice}, #{productDeliveryPrice}, #{productName}, #{status}, #{productThumbnail})
	</insert>
	
	<select id="selectId" resultType="java.lang.Long" parameterType="ProductOrderVO">
		select nvl(max(id) + 1, 0)
		from product_order
		where user_id = #{userId}
	</select>
	
	<select id="selectList" parameterType="ProductOrderVO" resultType="ProductOrderVO">
		<choose>
		    <when test="endNo != null and startNo != null">
				select 
					t2.*,
					to_char(t2.product_amount, 'FM999,999,999') fmt_product_amount,
					to_char(t2.product_delivery_price, 'FM999,999,999') fmt_product_delivery_price,
					to_char(t2.product_price, 'FM999,999,999') fmt_product_price,
					to_char(t2.product_amount * t2.product_price + t2.product_delivery_price, 'FM999,999,999') fmt_total_product_price
					
				from (	select t1.*, rownum rnum
						from (	select *
								from product_order
								where user_id = #{userId}
								order by id desc, product_id desc, product_name asc) t1
						where rownum <![CDATA[ <= ]]> #{endNo}) t2
				where rnum <![CDATA[ >= ]]> #{startNo}
		    </when>
		    <otherwise>
   				select *
				from product_order
				order by id desc, user_id asc
		    </otherwise>
		</choose>
	</select>
	<select id="totalCount" parameterType="ProductOrderVO" resultType="int">
		select count(*)
		from product_order
		where user_id = #{userId}
	</select>
	
	<update id="update" parameterType="ProductOrderVO">
		update product_order
		set MODIFY_DATE = sysdate 
			<if test="status">
				, status = #{status}
			</if>
	</update>
	
	
	
</mapper>














