<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Product">

	<!-- <typeAlias type="com.tjoeun.vo.MvcBoardVO" alias="MvcBoardVO" /> -->
	<insert id="insert" parameterType="ProductVO">
		insert into product(id, category_id, name, amount, price, discount, delivery_price, contents, thumbnail, seller_id)
		values(product_seq_id.nextval, #{categoryId}, #{name}, #{amount}, #{price}, #{discount}, #{deliveryPrice}, #{contents}, #{thumbnail}, #{sellerId})
	</insert>
	
	<select id="selectList" parameterType="java.util.HashMap" resultType="ProductVO">
		select 
			<if test="choose != null and choose == 'list'">
				rnum, id, name, discount, price, category_id, to_char(create_date, 'YYYY-MM-DD(DY) HH24:MI:SS ') create_date, delivery_price, amount,
				to_char(amount, 'FM999,999,999') fmt_amount,
				to_char(price, 'FM999,999,999') fmt_price,
				discount || '%' fmt_discount,
				to_char(delivery_price, 'FM999,999,999') fmt_delivery_price
			</if>
			<if test="choose != null and choose == 'detail'">
				rnum, id, name, discount, price, 
				category_id, to_char(create_date, 'YYYY-MM-DD(DY) HH24:MI:SS ') create_date, delivery_price, amount,
				
				price - price * (discount / 100) discountPrice,				
				to_char(amount, 'FM999,999,999') fmt_amount,
				to_char(price, 'FM999,999,999') fmt_price,
				discount || '%' fmt_discount,
				to_char(delivery_price, 'FM999,999,999') fmt_delivery_price,
				to_char(price - price * (discount / 100), 'FM999,999,999') fmt_discount_price
			</if>
			<if test="choose == null or choose == 'all'">
				*
			</if>
		
		from (	select t1.*, rownum rnum
				from (	select *
						from product
						where 1 = 1
						<if test="name != null">
							and name like '%' || ${name} || '%'
						</if>
						<if test="categoryId != null">
							and category_id = #{categoryId}
						</if>						
						order by id desc) t1
				where rownum <![CDATA[ <= ]]> #{endNo})
		where rnum <![CDATA[ >= ]]> #{startNo}
	</select>
	
	
	<select id="totalCount" parameterType="java.util.HashMap" resultType="int">
		select count(*)
		from product
		where 1 = 1
		<if test="name != null">
			and name like '%' || ${name} || '%'
		</if>
		<if test="categoryId != null">
			and category_id = #{categoryId}
		</if>
	</select>	
	
	<select id="select" parameterType="ProductVO" resultType="ProductVO">
		select
			<if test="choose == null">
				*
			</if>
			<if test="choose != null and choose == 'detail'">
				id, name, discount, price, category_id, to_char(create_date, 'YYYY-MM-DD(DY) HH24:MI:SS ') create_date, delivery_price, amount,
				contents,
				thumbnail,
				price - price * (discount / 100) discountPrice,				
				to_char(amount, 'FM999,999,999') fmt_amount,
				to_char(price, 'FM999,999,999') fmt_price,
				discount || '%' fmt_discount,
				to_char(delivery_price, 'FM999,999,999') fmt_delivery_price,
				to_char(price - price * (discount / 100), 'FM999,999,999') fmt_discount_price
			</if>
			
			
		from product
		where id = #{id}
	</select>
	
	<update id="update" parameterType="ProductVO">
		update product
		set	modify_date = sysdate			
			<if test="name != null">
				, name = #{name}
			</if>
			<if test="categoryId != null">
				, category_id = #{categoryId}
			</if>
			<if test="amount != null">
				, amount = #{amount}
			</if>
			<if test="price != null">
				, price = #{price}
			</if>
			<if test="discount != null">
				, discount = #{discount}
			</if>
			<if test="deliveryPrice != null">
				, delivery_price = #{deliveryPrice}
			</if>
			<if test="useYn != null">
				, use_yn = #{useYn}
			</if>
			<if test="contents != null">
				, contents = #{contents}
			</if>
			<if test="thumbnail != null">
				, thumbnail = #{thumbnail}
			</if>
		where id = #{id}
	</update>
	
</mapper>














